<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 950">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ffd93d"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1600" height="950" fill="#0a0a0f"/>

  <!-- Header -->
  <rect x="0" y="0" width="1600" height="60" fill="url(#headerGrad)"/>
  <text x="800" y="38" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="24" font-weight="bold">8-Stage CI/CD Pipeline - Detailed Execution</text>
  <text x="1580" y="38" text-anchor="end" fill="#888" font-family="Arial, sans-serif" font-size="12">Complete Pipeline Stages</text>

  <!-- Pipeline stages header -->
  <g transform="translate(50, 80)">
    <text x="0" y="0" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14" font-weight="bold">stages: [compile, build, test, sast, quality, security, push, notify]</text>
  </g>

  <!-- Stage 1: Compile -->
  <g filter="url(#shadow)" transform="translate(50, 110)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#6c5ce7"/>
    <text x="180" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 1: COMPILE</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.3)"/>
    <text x="20" y="60" fill="#ffd93d" font-family="monospace" font-size="9">image: ${NEXUS}/maven:3.9-eclipse-temurin-17</text>
    <text x="20" y="80" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#888" font-family="monospace" font-size="8">- mvn clean package -DskipTests</text>
    <text x="30" y="110" fill="#888" font-family="monospace" font-size="8">- find target -name "*.jar" | xargs cp {} target/app.jar</text>
    <text x="20" y="130" fill="#81ecec" font-family="monospace" font-size="9">artifacts:</text>
    <text x="30" y="145" fill="#888" font-family="monospace" font-size="8">paths: [target/app.jar]</text>
    <text x="30" y="160" fill="#888" font-family="monospace" font-size="8">expire_in: 1 hour</text>
    <text x="20" y="175" fill="#00b894" font-family="monospace" font-size="8">cache: [.m2/repository]</text>
  </g>
  <line x1="410" y1="205" x2="430" y2="205" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 2: Build -->
  <g filter="url(#shadow)" transform="translate(440, 110)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#e17055"/>
    <text x="180" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 2: BUILD</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.3)"/>
    <text x="20" y="60" fill="#ffd93d" font-family="monospace" font-size="9">image: ${NEXUS}/kaniko-project/executor:latest</text>
    <text x="20" y="80" fill="#e0e0e0" font-family="monospace" font-size="9">entrypoint: [""]</text>
    <text x="20" y="100" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="115" fill="#888" font-family="monospace" font-size="8">- mkdir -p /kaniko/.docker</text>
    <text x="30" y="130" fill="#888" font-family="monospace" font-size="8">- echo '{"auths":{...}}' &gt; config.json</text>
    <text x="30" y="145" fill="#888" font-family="monospace" font-size="8">- /kaniko/executor</text>
    <text x="35" y="160" fill="#81ecec" font-family="monospace" font-size="8">--destination ${NEXUS}/${IMAGE}:${TAG}</text>
    <text x="20" y="175" fill="#00b894" font-family="monospace" font-size="8">depends_on: compile</text>
  </g>
  <line x1="800" y1="205" x2="820" y2="205" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 3: Test -->
  <g filter="url(#shadow)" transform="translate(830, 110)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#00b894"/>
    <text x="180" y="25" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 3: TEST</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.2)"/>
    <text x="20" y="60" fill="#1a1a2e" font-family="monospace" font-size="9">image: ${NEXUS}/alpine-curl:latest</text>
    <text x="20" y="80" fill="#006060" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#006060" font-family="monospace" font-size="8">- apk add --no-cache curl jq</text>
    <text x="30" y="110" fill="#006060" font-family="monospace" font-size="8">- RESPONSE=$(curl -s -o /dev/null -w "%{http}"</text>
    <text x="35" y="125" fill="#006060" font-family="monospace" font-size="8">  -u "$USER:$PASS" "${NEXUS}/v2/.../manifests")</text>
    <text x="30" y="140" fill="#006060" font-family="monospace" font-size="8">- if [ "$RESPONSE" = "200" ]; then</text>
    <text x="35" y="155" fill="#006060" font-family="monospace" font-size="8">    echo "Image found in registry!"</text>
    <text x="20" y="175" fill="#1a1a2e" font-family="monospace" font-size="8">Verifies image exists in Nexus</text>
  </g>
  <line x1="1190" y1="205" x2="1210" y2="205" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 4: SAST -->
  <g filter="url(#shadow)" transform="translate(1220, 110)">
    <rect x="0" y="0" width="330" height="190" rx="12" fill="#0984e3"/>
    <text x="165" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 4: SAST</text>
    <rect x="10" y="40" width="310" height="140" rx="8" fill="rgba(0,0,0,0.3)"/>
    <text x="20" y="60" fill="#ffd93d" font-family="monospace" font-size="9">image: ${NEXUS}/maven:3.9</text>
    <text x="20" y="80" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#888" font-family="monospace" font-size="8">- echo "=== SpotBugs ==="</text>
    <text x="30" y="110" fill="#888" font-family="monospace" font-size="8">- mvn spotbugs:check || true</text>
    <text x="30" y="125" fill="#888" font-family="monospace" font-size="8">- echo "=== PMD ==="</text>
    <text x="30" y="140" fill="#888" font-family="monospace" font-size="8">- mvn pmd:check || true</text>
    <text x="20" y="160" fill="#81ecec" font-family="monospace" font-size="9">allow_failure: true</text>
    <text x="20" y="175" fill="#888" font-family="monospace" font-size="8">Bug detection + code analysis</text>
  </g>

  <!-- Row 2 -->
  <!-- Stage 5: Quality -->
  <g filter="url(#shadow)" transform="translate(50, 330)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#9b59b6"/>
    <text x="180" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 5: QUALITY</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.3)"/>
    <text x="20" y="60" fill="#ffd93d" font-family="monospace" font-size="9">image: ${NEXUS}/maven:3.9</text>
    <text x="20" y="80" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#888" font-family="monospace" font-size="8">- mvn sonar:sonar</text>
    <text x="35" y="110" fill="#888" font-family="monospace" font-size="8">-Dsonar.host.url=http://ai-sonarqube:9000</text>
    <text x="35" y="125" fill="#888" font-family="monospace" font-size="8">-Dsonar.token=${SONAR_TOKEN}</text>
    <text x="35" y="140" fill="#888" font-family="monospace" font-size="8">-Dsonar.projectKey=${CI_PROJECT_NAME}</text>
    <text x="20" y="160" fill="#81ecec" font-family="monospace" font-size="9">allow_failure: true</text>
    <text x="20" y="175" fill="#888" font-family="monospace" font-size="8">Code quality + security hotspots</text>
  </g>
  <line x1="410" y1="425" x2="430" y2="425" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 6: Security -->
  <g filter="url(#shadow)" transform="translate(440, 330)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#d63031"/>
    <text x="180" y="25" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 6: SECURITY</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.3)"/>
    <text x="20" y="60" fill="#ffd93d" font-family="monospace" font-size="9">image: ${NEXUS}/alpine-curl:latest</text>
    <text x="20" y="80" fill="#e0e0e0" font-family="monospace" font-size="9">services:</text>
    <text x="30" y="95" fill="#888" font-family="monospace" font-size="8">- name: ${NEXUS}/trivy:latest</text>
    <text x="35" y="110" fill="#888" font-family="monospace" font-size="8">alias: trivy-server</text>
    <text x="35" y="125" fill="#888" font-family="monospace" font-size="8">command: ["server", "--listen", ":8080"]</text>
    <text x="20" y="145" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="160" fill="#888" font-family="monospace" font-size="8">- trivy image --server http://trivy:8080</text>
    <text x="35" y="175" fill="#81ecec" font-family="monospace" font-size="8">--severity HIGH,CRITICAL ${IMAGE}</text>
  </g>
  <line x1="800" y1="425" x2="820" y2="425" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 7: Push -->
  <g filter="url(#shadow)" transform="translate(830, 330)">
    <rect x="0" y="0" width="360" height="190" rx="12" fill="#fdcb6e"/>
    <text x="180" y="25" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 7: PUSH</text>
    <rect x="10" y="40" width="340" height="140" rx="8" fill="rgba(0,0,0,0.2)"/>
    <text x="20" y="60" fill="#1a1a2e" font-family="monospace" font-size="9">image: ${NEXUS}/alpine-curl:latest</text>
    <text x="20" y="80" fill="#666" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#666" font-family="monospace" font-size="8">- MANIFEST=$(curl -s -u "$U:$P"</text>
    <text x="35" y="110" fill="#666" font-family="monospace" font-size="8">  "${NEXUS}/v2/.../manifests/latest")</text>
    <text x="30" y="125" fill="#666" font-family="monospace" font-size="8">- curl -X PUT -u "$U:$P"</text>
    <text x="35" y="140" fill="#666" font-family="monospace" font-size="8">  -d "$MANIFEST"</text>
    <text x="35" y="155" fill="#666" font-family="monospace" font-size="8">  "${NEXUS}/v2/.../manifests/${RELEASE_TAG}"</text>
    <text x="20" y="175" fill="#1a1a2e" font-family="monospace" font-size="8">Tags release: 1.0.release-${IID}</text>
  </g>
  <line x1="1190" y1="425" x2="1210" y2="425" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 8: Notify -->
  <g filter="url(#shadow)" transform="translate(1220, 330)">
    <rect x="0" y="0" width="330" height="190" rx="12" fill="#00cec9"/>
    <text x="165" y="25" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage 8: NOTIFY</text>
    <rect x="10" y="40" width="310" height="140" rx="8" fill="rgba(0,0,0,0.2)"/>
    <text x="20" y="60" fill="#1a1a2e" font-family="monospace" font-size="9">image: ${NEXUS}/alpine-curl:latest</text>
    <text x="20" y="80" fill="#006666" font-family="monospace" font-size="9">script:</text>
    <text x="30" y="95" fill="#006666" font-family="monospace" font-size="8">- curl -k -X POST</text>
    <text x="35" y="110" fill="#006666" font-family="monospace" font-size="8">"${SPLUNK_HEC}/services/collector"</text>
    <text x="35" y="125" fill="#006666" font-family="monospace" font-size="8">-H "Authorization: Splunk $TOKEN"</text>
    <text x="35" y="140" fill="#006666" font-family="monospace" font-size="8">-d '{"event":{...}}'</text>
    <text x="20" y="160" fill="#1a1a2e" font-family="monospace" font-size="9">when: on_success</text>
    <text x="20" y="175" fill="#006666" font-family="monospace" font-size="8">Pipeline status to Splunk</text>
  </g>

  <!-- Variables Section -->
  <g transform="translate(50, 550)">
    <text x="0" y="0" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Pipeline Variables (All Stages)</text>

    <g filter="url(#shadow)" transform="translate(0, 20)">
      <rect x="0" y="0" width="1500" height="100" rx="15" fill="#1a1a2e"/>
      <rect x="15" y="15" width="1470" height="70" rx="10" fill="rgba(0,0,0,0.3)"/>

      <text x="30" y="40" fill="#ffd93d" font-family="monospace" font-size="9">variables:</text>
      <text x="45" y="58" fill="#e0e0e0" font-family="monospace" font-size="9">NEXUS_REGISTRY: "ai-nexus:5001"</text>
      <text x="310" y="58" fill="#e0e0e0" font-family="monospace" font-size="9">NEXUS_PULL_REGISTRY: "localhost:5001"</text>
      <text x="620" y="58" fill="#e0e0e0" font-family="monospace" font-size="9">IMAGE_NAME: "${CI_PROJECT_NAME}"</text>
      <text x="45" y="78" fill="#e0e0e0" font-family="monospace" font-size="9">IMAGE_TAG: "1.0.${CI_PIPELINE_IID}"</text>
      <text x="310" y="78" fill="#e0e0e0" font-family="monospace" font-size="9">RELEASE_TAG: "1.0.release-${CI_PIPELINE_IID}"</text>
      <text x="620" y="78" fill="#e0e0e0" font-family="monospace" font-size="9">FF_NETWORK_PER_BUILD: "true"</text>
      <text x="920" y="58" fill="#81ecec" font-family="monospace" font-size="9">DOCKER_HOST: "tcp://docker:2375"</text>
      <text x="920" y="78" fill="#81ecec" font-family="monospace" font-size="9">DOCKER_TLS_CERTDIR: ""</text>
    </g>
  </g>

  <!-- Dependencies Flow -->
  <g transform="translate(50, 690)">
    <text x="0" y="0" fill="#00b894" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Stage Dependencies &amp; Artifacts Flow</text>

    <g filter="url(#shadow)" transform="translate(0, 20)">
      <rect x="0" y="0" width="1500" height="180" rx="15" fill="#2d3436"/>

      <!-- Dependency flow -->
      <g transform="translate(30, 30)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#6c5ce7"/>
        <text x="65" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">compile</text>
        <text x="65" y="38" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="7">app.jar</text>
      </g>
      <path d="M 160 55 L 200 55 L 200 25" stroke="#ffd93d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

      <g transform="translate(200, 0)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#e17055"/>
        <text x="65" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">build</text>
        <text x="65" y="38" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="7">Docker image</text>
      </g>
      <line x1="330" y1="25" x2="390" y2="25" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

      <g transform="translate(390, 0)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#00b894"/>
        <text x="65" y="22" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10" font-weight="bold">test</text>
        <text x="65" y="38" text-anchor="middle" fill="#006060" font-family="monospace" font-size="7">Verify in registry</text>
      </g>

      <!-- Parallel SAST/Quality -->
      <path d="M 520 25 L 560 25 L 560 10 L 600 10" stroke="#ffd93d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
      <path d="M 520 25 L 560 25 L 560 55 L 600 55" stroke="#ffd93d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

      <g transform="translate(600, 0)">
        <rect x="0" y="-15" width="100" height="35" rx="6" fill="#0984e3"/>
        <text x="50" y="5" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="9">sast</text>
      </g>
      <g transform="translate(600, 35)">
        <rect x="0" y="0" width="100" height="35" rx="6" fill="#9b59b6"/>
        <text x="50" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="9">quality</text>
      </g>

      <line x1="700" y1="25" x2="750" y2="25" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

      <g transform="translate(750, 0)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#d63031"/>
        <text x="65" y="22" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">security</text>
        <text x="65" y="38" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="7">Trivy scan</text>
      </g>
      <line x1="880" y1="25" x2="930" y2="25" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

      <g transform="translate(930, 0)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#fdcb6e"/>
        <text x="65" y="22" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10" font-weight="bold">push</text>
        <text x="65" y="38" text-anchor="middle" fill="#666" font-family="monospace" font-size="7">Tag release</text>
      </g>
      <line x1="1060" y1="25" x2="1110" y2="25" stroke="#ffd93d" stroke-width="2" marker-end="url(#arrowhead)"/>

      <g transform="translate(1110, 0)">
        <rect x="0" y="0" width="130" height="50" rx="8" fill="#00cec9"/>
        <text x="65" y="22" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="10" font-weight="bold">notify</text>
        <text x="65" y="38" text-anchor="middle" fill="#006666" font-family="monospace" font-size="7">Splunk HEC</text>
      </g>

      <!-- Legend -->
      <rect x="30" y="95" width="1410" height="70" rx="10" fill="rgba(0,0,0,0.3)"/>
      <text x="50" y="120" fill="#ffd93d" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Key Points:</text>
      <text x="50" y="140" fill="#888" font-family="monospace" font-size="9">1. All images from localhost:5001 (Nexus)</text>
      <text x="370" y="140" fill="#888" font-family="monospace" font-size="9">2. Artifacts passed via GitLab</text>
      <text x="630" y="140" fill="#888" font-family="monospace" font-size="9">3. SAST/Quality run in parallel</text>
      <text x="920" y="140" fill="#888" font-family="monospace" font-size="9">4. Trivy runs as service container</text>
      <text x="1200" y="140" fill="#888" font-family="monospace" font-size="9">5. Notify only on success</text>
    </g>
  </g>

  <!-- Footer -->
  <text x="800" y="930" text-anchor="middle" fill="#555" font-family="Arial, sans-serif" font-size="11">AI-Powered DevOps Platform | 8-Stage CI/CD Pipeline | Complete Build to Deploy</text>
</svg>