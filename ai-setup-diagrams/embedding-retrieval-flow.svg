<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 850">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <linearGradient id="embedGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00cec9"/>
      <stop offset="100%" style="stop-color:#81ecec"/>
    </linearGradient>
    <linearGradient id="vectorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fd79a8"/>
      <stop offset="100%" style="stop-color:#e84393"/>
    </linearGradient>
    <linearGradient id="resultGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00b894"/>
      <stop offset="100%" style="stop-color:#55efc4"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowCyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00cec9"/>
    </marker>
    <marker id="arrowPink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fd79a8"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00b894"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6c5ce7"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="850" fill="#0a0a0f"/>

  <!-- Header -->
  <rect x="0" y="0" width="1400" height="60" fill="url(#headerGrad)"/>
  <text x="700" y="38" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="24" font-weight="bold">Embedding &amp; Retrieval Flow</text>
  <text x="1380" y="38" text-anchor="end" fill="#888" font-family="Arial, sans-serif" font-size="12">Semantic Vector Search</text>

  <!-- Phase 1: Document Ingestion -->
  <g transform="translate(50, 80)">
    <text x="0" y="0" fill="#00cec9" font-family="Arial, sans-serif" font-size="16" font-weight="bold">ğŸ“¥ Phase 1: Document Ingestion (ingest_templates.py)</text>

    <!-- Source Document -->
    <g filter="url(#shadow)" transform="translate(0, 30)">
      <rect x="0" y="0" width="250" height="140" rx="15" fill="#1a1a2e" stroke="#6c5ce7" stroke-width="2"/>
      <text x="125" y="30" text-anchor="middle" fill="#6c5ce7" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ“„ Source Document</text>
      <rect x="15" y="45" width="220" height="80" rx="8" fill="#2d3436"/>
      <text x="25" y="68" fill="#a29bfe" font-family="monospace" font-size="9">templates/dockerfile/java.txt</text>
      <text x="25" y="88" fill="#e0e0e0" font-family="monospace" font-size="8">FROM ${BASE_REGISTRY}/maven:3.9</text>
      <text x="25" y="103" fill="#e0e0e0" font-family="monospace" font-size="8">WORKDIR /app</text>
      <text x="25" y="118" fill="#e0e0e0" font-family="monospace" font-size="8">COPY pom.xml ...</text>
    </g>

    <path d="M 250 100 L 300 100" stroke="#6c5ce7" stroke-width="2" marker-end="url(#arrowPurple)"/>

    <!-- Text Chunking -->
    <g filter="url(#shadow)" transform="translate(310, 30)">
      <rect x="0" y="0" width="220" height="140" rx="15" fill="url(#embedGrad)"/>
      <text x="110" y="30" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="12" font-weight="bold">âœ‚ï¸ Text Processing</text>
      <rect x="15" y="45" width="190" height="80" rx="8" fill="rgba(0,0,0,0.2)"/>
      <text x="25" y="68" fill="#1a1a2e" font-family="monospace" font-size="9">1. Read template file</text>
      <text x="25" y="88" fill="#1a1a2e" font-family="monospace" font-size="9">2. Extract metadata</text>
      <text x="25" y="108" fill="#1a1a2e" font-family="monospace" font-size="9">3. Prepare for embedding</text>
    </g>

    <path d="M 530 100 L 580 100" stroke="#00cec9" stroke-width="2" marker-end="url(#arrowCyan)"/>

    <!-- Embedding Model -->
    <g filter="url(#shadow)" transform="translate(590, 30)">
      <rect x="0" y="0" width="260" height="140" rx="15" fill="#1a1a2e" stroke="#ffd93d" stroke-width="2"/>
      <text x="130" y="30" text-anchor="middle" fill="#ffd93d" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ§¬ Embedding Model</text>
      <rect x="15" y="45" width="230" height="80" rx="8" fill="#2d3436"/>
      <text x="25" y="68" fill="#ffd93d" font-family="monospace" font-size="9">all-MiniLM-L6-v2</text>
      <text x="25" y="88" fill="#e0e0e0" font-family="monospace" font-size="8">Input: "FROM ${BASE_REGISTRY}..."</text>
      <text x="25" y="108" fill="#e0e0e0" font-family="monospace" font-size="8">Output: [0.23, 0.87, 0.45, ...]</text>
      <text x="25" y="123" fill="#888" font-family="monospace" font-size="7">384 dimensions</text>
    </g>

    <path d="M 850 100 L 900 100" stroke="#ffd93d" stroke-width="2"/>

    <!-- ChromaDB Storage -->
    <g filter="url(#shadow)" transform="translate(910, 30)">
      <rect x="0" y="0" width="250" height="140" rx="15" fill="url(#vectorGrad)"/>
      <text x="125" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ’¾ ChromaDB Store</text>
      <rect x="15" y="45" width="220" height="80" rx="8" fill="rgba(0,0,0,0.3)"/>
      <text x="25" y="68" fill="#fff" font-family="monospace" font-size="9">collection.add(</text>
      <text x="35" y="85" fill="#e0e0e0" font-family="monospace" font-size="8">ids=["java-spring-001"],</text>
      <text x="35" y="100" fill="#e0e0e0" font-family="monospace" font-size="8">documents=[template],</text>
      <text x="35" y="115" fill="#e0e0e0" font-family="monospace" font-size="8">metadatas=[{stack:"java"}])</text>
    </g>
  </g>

  <!-- Phase 2: Query & Retrieval -->
  <g transform="translate(50, 280)">
    <text x="0" y="0" fill="#fd79a8" font-family="Arial, sans-serif" font-size="16" font-weight="bold">ğŸ” Phase 2: Query &amp; Retrieval (generator_api.py)</text>

    <!-- User Query -->
    <g filter="url(#shadow)" transform="translate(0, 30)">
      <rect x="0" y="0" width="250" height="160" rx="15" fill="#1a1a2e" stroke="#6c5ce7" stroke-width="2"/>
      <text x="125" y="30" text-anchor="middle" fill="#6c5ce7" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ‘¤ User Query</text>
      <rect x="15" y="45" width="220" height="100" rx="8" fill="#2d3436"/>
      <text x="25" y="68" fill="#a29bfe" font-family="monospace" font-size="9">POST /generate/dockerfile</text>
      <text x="25" y="88" fill="#e0e0e0" font-family="monospace" font-size="8">{</text>
      <text x="35" y="103" fill="#e0e0e0" font-family="monospace" font-size="8">"stack": "java",</text>
      <text x="35" y="118" fill="#e0e0e0" font-family="monospace" font-size="8">"framework": "spring-boot"</text>
      <text x="25" y="133" fill="#e0e0e0" font-family="monospace" font-size="8">}</text>
    </g>

    <path d="M 250 110 L 300 110" stroke="#6c5ce7" stroke-width="2" marker-end="url(#arrowPurple)"/>

    <!-- Query Embedding -->
    <g filter="url(#shadow)" transform="translate(310, 30)">
      <rect x="0" y="0" width="240" height="160" rx="15" fill="url(#embedGrad)"/>
      <text x="120" y="30" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ§¬ Query Embedding</text>
      <rect x="15" y="45" width="210" height="100" rx="8" fill="rgba(0,0,0,0.2)"/>
      <text x="25" y="68" fill="#1a1a2e" font-family="monospace" font-size="9">query_text =</text>
      <text x="25" y="85" fill="#006060" font-family="monospace" font-size="8">"java spring-boot application"</text>
      <text x="25" y="108" fill="#1a1a2e" font-family="monospace" font-size="9">â†’ embedded to:</text>
      <text x="25" y="125" fill="#006060" font-family="monospace" font-size="8">[0.21, 0.89, 0.42, ...]</text>
      <text x="25" y="140" fill="#1a1a2e" font-family="monospace" font-size="7">384 dimensions</text>
    </g>

    <path d="M 550 110 L 600 110" stroke="#00cec9" stroke-width="2" marker-end="url(#arrowCyan)"/>

    <!-- Vector Search -->
    <g filter="url(#shadow)" transform="translate(610, 30)">
      <rect x="0" y="0" width="280" height="160" rx="15" fill="url(#vectorGrad)"/>
      <text x="140" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ğŸ“Š Vector Similarity Search</text>
      <rect x="15" y="45" width="250" height="100" rx="8" fill="rgba(0,0,0,0.3)"/>
      <text x="25" y="68" fill="#fff" font-family="monospace" font-size="9">collection.query(</text>
      <text x="35" y="85" fill="#e0e0e0" font-family="monospace" font-size="8">query_texts=[query_text],</text>
      <text x="35" y="100" fill="#e0e0e0" font-family="monospace" font-size="8">n_results=1,</text>
      <text x="35" y="115" fill="#ffd0d0" font-family="monospace" font-size="8">where={"stack": "java"}</text>
      <text x="25" y="130" fill="#fff" font-family="monospace" font-size="9">)</text>
    </g>

    <path d="M 890 110 L 940 110" stroke="#fd79a8" stroke-width="2" marker-end="url(#arrowPink)"/>

    <!-- Results -->
    <g filter="url(#shadow)" transform="translate(950, 30)">
      <rect x="0" y="0" width="270" height="160" rx="15" fill="url(#resultGrad)"/>
      <text x="135" y="30" text-anchor="middle" fill="#1a1a2e" font-family="Arial, sans-serif" font-size="12" font-weight="bold">âœ… Top Match</text>
      <rect x="15" y="45" width="240" height="100" rx="8" fill="rgba(0,0,0,0.2)"/>
      <text x="25" y="68" fill="#1a1a2e" font-family="monospace" font-size="9">id: "java-spring-001"</text>
      <text x="25" y="88" fill="#006060" font-family="monospace" font-size="8">similarity: 0.97</text>
      <text x="25" y="108" fill="#1a1a2e" font-family="monospace" font-size="9">document: "FROM ${BASE}..."</text>
      <text x="25" y="128" fill="#006060" font-family="monospace" font-size="8">metadata: {stack:"java",</text>
      <text x="80" y="143" fill="#006060" font-family="monospace" font-size="8">framework:"spring"}</text>
    </g>
  </g>

  <!-- Vector Space Visualization -->
  <g filter="url(#shadow)" transform="translate(50, 500)">
    <rect x="0" y="0" width="600" height="280" rx="20" fill="#1a1a2e" stroke="#ffd93d" stroke-width="2"/>
    <text x="300" y="35" text-anchor="middle" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14" font-weight="bold">ğŸ“ˆ Vector Space Visualization</text>

    <!-- Coordinate system -->
    <line x1="100" y1="240" x2="550" y2="240" stroke="#636e72" stroke-width="1"/>
    <line x1="100" y1="60" x2="100" y2="240" stroke="#636e72" stroke-width="1"/>
    <text x="550" y="255" fill="#888" font-family="Arial, sans-serif" font-size="9">Dimension 1</text>
    <text x="50" y="150" fill="#888" font-family="Arial, sans-serif" font-size="9" transform="rotate(-90, 50, 150)">Dimension 2</text>

    <!-- Query point -->
    <circle cx="250" cy="120" r="12" fill="#6c5ce7"/>
    <text x="265" y="125" fill="#a29bfe" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Query</text>

    <!-- Matching points -->
    <circle cx="270" cy="105" r="8" fill="#00b894"/>
    <text x="285" y="105" fill="#55efc4" font-family="monospace" font-size="8">java-spring-001 (0.97)</text>

    <circle cx="300" cy="140" r="8" fill="#ffd93d"/>
    <text x="315" y="145" fill="#ffeaa7" font-family="monospace" font-size="8">java-maven-002 (0.89)</text>

    <circle cx="350" cy="180" r="8" fill="#e17055"/>
    <text x="365" y="185" fill="#fab1a0" font-family="monospace" font-size="8">java-quarkus-001 (0.72)</text>

    <!-- Non-matching points -->
    <circle cx="450" cy="200" r="6" fill="#636e72"/>
    <text x="465" y="205" fill="#888" font-family="monospace" font-size="7">python-flask (0.34)</text>

    <circle cx="480" cy="100" r="6" fill="#636e72"/>
    <text x="495" y="105" fill="#888" font-family="monospace" font-size="7">node-express (0.28)</text>

    <!-- Distance lines -->
    <line x1="250" y1="120" x2="270" y2="105" stroke="#00b894" stroke-width="2" stroke-dasharray="3,3"/>
    <line x1="250" y1="120" x2="300" y2="140" stroke="#ffd93d" stroke-width="1" stroke-dasharray="3,3"/>
  </g>

  <!-- Similarity Scoring -->
  <g filter="url(#shadow)" transform="translate(680, 500)">
    <rect x="0" y="0" width="670" height="280" rx="20" fill="#1a1a2e" stroke="#00b894" stroke-width="2"/>
    <text x="335" y="35" text-anchor="middle" fill="#00b894" font-family="Arial, sans-serif" font-size="14" font-weight="bold">ğŸ“Š Similarity Scoring &amp; Ranking</text>

    <!-- Cosine Similarity Formula -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="300" height="80" rx="10" fill="#2d3436"/>
      <text x="150" y="25" text-anchor="middle" fill="#00cec9" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Cosine Similarity</text>
      <text x="150" y="50" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="10">cos(Î¸) = AÂ·B / (||A|| Ã— ||B||)</text>
      <text x="150" y="70" text-anchor="middle" fill="#888" font-family="monospace" font-size="8">Range: 0 (orthogonal) to 1 (identical)</text>
    </g>

    <!-- Metadata Filter -->
    <g transform="translate(340, 55)">
      <rect x="0" y="0" width="310" height="80" rx="10" fill="#2d3436"/>
      <text x="155" y="25" text-anchor="middle" fill="#ffd93d" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Metadata Filtering</text>
      <text x="20" y="50" fill="#ffd93d" font-family="monospace" font-size="9">where={"stack": "java"}</text>
      <text x="20" y="70" fill="#888" font-family="monospace" font-size="8">Pre-filter before vector search</text>
    </g>

    <!-- Results Table -->
    <g transform="translate(20, 150)">
      <rect x="0" y="0" width="630" height="110" rx="10" fill="#2d3436"/>
      <text x="315" y="25" text-anchor="middle" fill="#fd79a8" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Ranked Results (Top 3)</text>

      <!-- Headers -->
      <text x="30" y="50" fill="#888" font-family="monospace" font-size="9">Rank</text>
      <text x="80" y="50" fill="#888" font-family="monospace" font-size="9">Document ID</text>
      <text x="250" y="50" fill="#888" font-family="monospace" font-size="9">Similarity</text>
      <text x="350" y="50" fill="#888" font-family="monospace" font-size="9">Metadata Match</text>
      <text x="500" y="50" fill="#888" font-family="monospace" font-size="9">Status</text>

      <!-- Row 1 -->
      <text x="30" y="72" fill="#55efc4" font-family="monospace" font-size="9">1</text>
      <text x="80" y="72" fill="#e0e0e0" font-family="monospace" font-size="9">java-spring-001</text>
      <text x="250" y="72" fill="#55efc4" font-family="monospace" font-size="9">0.97</text>
      <text x="350" y="72" fill="#55efc4" font-family="monospace" font-size="9">âœ“ stack=java</text>
      <text x="500" y="72" fill="#55efc4" font-family="monospace" font-size="9">SELECTED</text>

      <!-- Row 2 -->
      <text x="30" y="90" fill="#ffeaa7" font-family="monospace" font-size="9">2</text>
      <text x="80" y="90" fill="#e0e0e0" font-family="monospace" font-size="9">java-maven-002</text>
      <text x="250" y="90" fill="#ffeaa7" font-family="monospace" font-size="9">0.89</text>
      <text x="350" y="90" fill="#ffeaa7" font-family="monospace" font-size="9">âœ“ stack=java</text>
      <text x="500" y="90" fill="#888" font-family="monospace" font-size="9">backup</text>

      <!-- Row 3 -->
      <text x="30" y="108" fill="#fab1a0" font-family="monospace" font-size="9">3</text>
      <text x="80" y="108" fill="#e0e0e0" font-family="monospace" font-size="9">java-quarkus-001</text>
      <text x="250" y="108" fill="#fab1a0" font-family="monospace" font-size="9">0.72</text>
      <text x="350" y="108" fill="#fab1a0" font-family="monospace" font-size="9">âœ“ stack=java</text>
      <text x="500" y="108" fill="#888" font-family="monospace" font-size="9">backup</text>
    </g>
  </g>

  <!-- Footer -->
  <text x="700" y="830" text-anchor="middle" fill="#555" font-family="Arial, sans-serif" font-size="11">AI-Powered DevOps Platform | Embedding &amp; Retrieval Flow | Semantic Vector Search for Template Matching</text>
</svg>