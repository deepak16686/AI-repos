<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1600">
  <defs>
    <!-- Gradients -->
    <linearGradient id="userGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4fc3f7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0288d1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gitlabGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fc6d26;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e24329;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ce93d8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7b1fa2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="backendGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ffb74d;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f57c00;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="fileGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#90caf9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1565c0;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="javaGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f44336;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b71c1c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="pythonGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4caf50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1b5e20;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8bc34a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#33691e;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="goGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00bcd4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#006064;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dotnetGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9c27b0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4a148c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#66bb6a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ragGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7e57c2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#311b92;stop-opacity:1" />
    </linearGradient>
    
    <!-- Filters -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.25"/>
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Arrow Markers -->
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1976d2"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f57c00"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7b1fa2"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2e7d32"/>
    </marker>
    <marker id="arrowGitlab" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e24329"/>
    </marker>
    <marker id="arrowCyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00838f"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="1600" fill="#fafafa"/>
  
  <!-- Title Section -->
  <rect x="0" y="0" width="1400" height="85" fill="#1a237e"/>
  <text x="700" y="35" font-family="Segoe UI, Arial, sans-serif" font-size="26" font-weight="bold" fill="white" text-anchor="middle">AI-Powered Repository Language &amp; Tech Stack Auto-Detection</text>
  <text x="700" y="60" font-family="Segoe UI, Arial, sans-serif" font-size="14" fill="#b3e5fc" text-anchor="middle">Detailed Architecture: From Repo URL to Detected Technology Context</text>
  <text x="700" y="78" font-family="Segoe UI, Arial, sans-serif" font-size="12" fill="#80deea" text-anchor="middle">No Manual Input Required â€¢ Automatic Detection via GitLab API + LLM Analysis</text>

  <!-- ==================== STEP 1: USER INPUT ==================== -->
  <rect x="20" y="105" width="1360" height="140" rx="12" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
  <text x="40" y="135" font-family="Segoe UI, Arial, sans-serif" font-size="18" font-weight="bold" fill="#1565c0">STEP 1: User Input (Minimal)</text>
  
  <!-- User -->
  <g transform="translate(60, 155)">
    <circle cx="40" cy="30" r="32" fill="url(#userGrad)" filter="url(#shadow)"/>
    <text x="40" y="38" font-family="Segoe UI, Arial, sans-serif" font-size="28" fill="white" text-anchor="middle">ğŸ‘¤</text>
    <text x="40" y="80" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#0277bd" text-anchor="middle">DevOps Admin</text>
  </g>
  
  <!-- Input Box -->
  <rect x="160" y="155" width="300" height="75" rx="8" fill="white" stroke="#42a5f5" stroke-width="2" filter="url(#shadow)"/>
  <text x="310" y="180" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="600" fill="#1565c0" text-anchor="middle">User Provides ONLY:</text>
  <text x="175" y="205" font-family="Consolas, monospace" font-size="11" fill="#2e7d32">âœ“ repo_url: gitlab.company.com/app/myservice</text>
  <text x="175" y="222" font-family="Consolas, monospace" font-size="11" fill="#2e7d32">âœ“ target_registry: nexus-prod:5001</text>
  
  <!-- NOT Required -->
  <rect x="480" y="155" width="220" height="75" rx="8" fill="#ffebee" stroke="#ef5350" stroke-width="2"/>
  <text x="590" y="180" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="600" fill="#c62828" text-anchor="middle">NOT Required (Auto-Detected):</text>
  <text x="495" y="200" font-family="Consolas, monospace" font-size="10" fill="#c62828">âœ— Language (Java/Python/Node...)</text>
  <text x="495" y="215" font-family="Consolas, monospace" font-size="10" fill="#c62828">âœ— Build tool (Maven/Gradle/npm...)</text>
  <text x="495" y="230" font-family="Consolas, monospace" font-size="10" fill="#c62828">âœ— Framework (Spring/Django/Express)</text>
  
  <!-- Arrow to Backend -->
  <path d="M700 195 L760 195" stroke="#1976d2" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>
  <circle cx="730" cy="195" r="14" fill="#1976d2"/>
  <text x="730" y="200" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">1</text>
  
  <!-- Backend Orchestrator -->
  <rect x="770" y="150" width="280" height="85" rx="10" fill="url(#backendGrad)" filter="url(#shadow)"/>
  <text x="910" y="180" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">âš™ï¸ Backend Orchestrator</text>
  <rect x="785" y="192" width="250" height="35" rx="4" fill="rgba(255,255,255,0.95)"/>
  <text x="910" y="213" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#e65100" text-anchor="middle">Receives repo URL â†’ Triggers detection flow</text>
  
  <!-- Arrow to GitLab -->
  <path d="M1050 195 L1110 195" stroke="#f57c00" stroke-width="3" fill="none" marker-end="url(#arrowOrange)"/>
  <circle cx="1080" cy="195" r="14" fill="#f57c00"/>
  <text x="1080" y="200" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">2</text>
  
  <!-- GitLab API Call -->
  <rect x="1120" y="150" width="240" height="85" rx="10" fill="url(#gitlabGrad)" filter="url(#shadow)"/>
  <text x="1240" y="180" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸ¦Š GitLab API</text>
  <rect x="1135" y="192" width="210" height="35" rx="4" fill="rgba(255,255,255,0.95)"/>
  <text x="1240" y="208" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#e65100" text-anchor="middle">GET /api/v4/projects/:id/repository</text>
  <text x="1240" y="222" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#e65100" text-anchor="middle">/tree, /files, /languages</text>

  <!-- ==================== STEP 2: GITLAB REPOSITORY INSPECTION ==================== -->
  <rect x="20" y="265" width="1360" height="340" rx="12" fill="#fff3e0" stroke="#ff9800" stroke-width="2" filter="url(#shadow)"/>
  <text x="40" y="295" font-family="Segoe UI, Arial, sans-serif" font-size="18" font-weight="bold" fill="#e65100">STEP 2: GitLab Repository Inspection (MCP Tool: gitlab_inspect_repo)</text>
  
  <!-- Repository Structure -->
  <rect x="40" y="315" width="400" height="270" rx="10" fill="url(#gitlabGrad)" filter="url(#shadow)"/>
  <text x="240" y="345" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸ“ Repository File Tree Scan</text>
  
  <rect x="55" y="360" width="370" height="210" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="240" y="382" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#e65100" text-anchor="middle">Files Retrieved via GitLab API:</text>
  
  <!-- File tree visualization -->
  <text x="70" y="405" font-family="Consolas, monospace" font-size="10" fill="#37474f">ğŸ“‚ myservice/</text>
  <text x="85" y="422" font-family="Consolas, monospace" font-size="10" fill="#1565c0">â”œâ”€â”€ ğŸ“„ pom.xml</text>
  <text x="85" y="439" font-family="Consolas, monospace" font-size="10" fill="#1565c0">â”œâ”€â”€ ğŸ“„ package.json</text>
  <text x="85" y="456" font-family="Consolas, monospace" font-size="10" fill="#1565c0">â”œâ”€â”€ ğŸ“„ requirements.txt</text>
  <text x="85" y="473" font-family="Consolas, monospace" font-size="10" fill="#1565c0">â”œâ”€â”€ ğŸ“„ go.mod</text>
  <text x="85" y="490" font-family="Consolas, monospace" font-size="10" fill="#1565c0">â”œâ”€â”€ ğŸ“„ *.csproj</text>
  <text x="85" y="507" font-family="Consolas, monospace" font-size="10" fill="#64748b">â”œâ”€â”€ ğŸ“„ Dockerfile (if exists)</text>
  <text x="85" y="524" font-family="Consolas, monospace" font-size="10" fill="#64748b">â”œâ”€â”€ ğŸ“„ .gitlab-ci.yml (if exists)</text>
  <text x="85" y="541" font-family="Consolas, monospace" font-size="10" fill="#37474f">â”œâ”€â”€ ğŸ“‚ src/</text>
  <text x="85" y="558" font-family="Consolas, monospace" font-size="10" fill="#37474f">â””â”€â”€ ğŸ“‚ ...</text>
  
  <!-- Arrow to Detection Rules -->
  <path d="M440 450 L480 450" stroke="#e24329" stroke-width="3" fill="none" marker-end="url(#arrowGitlab)"/>
  <circle cx="460" cy="450" r="14" fill="#e24329"/>
  <text x="460" y="455" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">3</text>
  
  <!-- Detection Rules Matrix -->
  <rect x="490" y="315" width="440" height="270" rx="10" fill="white" stroke="#ff9800" stroke-width="2" filter="url(#shadow)"/>
  <text x="710" y="345" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="#e65100" text-anchor="middle">ğŸ” File Pattern Detection Rules</text>
  
  <!-- Java Detection -->
  <rect x="505" y="360" width="200" height="50" rx="5" fill="url(#javaGrad)" filter="url(#shadow)"/>
  <text x="605" y="382" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">â˜• Java Detection</text>
  <text x="605" y="400" font-family="Consolas, monospace" font-size="9" fill="#ffcdd2" text-anchor="middle">pom.xml | build.gradle | *.java</text>
  
  <!-- Python Detection -->
  <rect x="715" y="360" width="200" height="50" rx="5" fill="url(#pythonGrad)" filter="url(#shadow)"/>
  <text x="815" y="382" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">ğŸ Python Detection</text>
  <text x="815" y="400" font-family="Consolas, monospace" font-size="9" fill="#c8e6c9" text-anchor="middle">requirements.txt | setup.py | *.py</text>
  
  <!-- Node.js Detection -->
  <rect x="505" y="420" width="200" height="50" rx="5" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="605" y="442" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">ğŸ“¦ Node.js Detection</text>
  <text x="605" y="460" font-family="Consolas, monospace" font-size="9" fill="#dcedc8" text-anchor="middle">package.json | yarn.lock | *.js/ts</text>
  
  <!-- Go Detection -->
  <rect x="715" y="420" width="200" height="50" rx="5" fill="url(#goGrad)" filter="url(#shadow)"/>
  <text x="815" y="442" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">ğŸ¹ Go Detection</text>
  <text x="815" y="460" font-family="Consolas, monospace" font-size="9" fill="#b2ebf2" text-anchor="middle">go.mod | go.sum | *.go</text>
  
  <!-- .NET Detection -->
  <rect x="505" y="480" width="200" height="50" rx="5" fill="url(#dotnetGrad)" filter="url(#shadow)"/>
  <text x="605" y="502" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">ğŸ”· .NET Detection</text>
  <text x="605" y="520" font-family="Consolas, monospace" font-size="9" fill="#e1bee7" text-anchor="middle">*.csproj | *.sln | *.cs</text>
  
  <!-- Multi-language -->
  <rect x="715" y="480" width="200" height="50" rx="5" fill="#607d8b" filter="url(#shadow)"/>
  <text x="815" y="502" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">ğŸ”€ Multi-Language</text>
  <text x="815" y="520" font-family="Consolas, monospace" font-size="9" fill="#cfd8dc" text-anchor="middle">Monorepo detection logic</text>
  
  <!-- Additional Signals -->
  <rect x="505" y="540" width="410" height="35" rx="4" fill="#fff8e1"/>
  <text x="710" y="562" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#f57f17" text-anchor="middle">ğŸ“Š GitLab Languages API: GET /projects/:id/languages â†’ {Java: 65%, HTML: 20%, CSS: 15%}</text>
  
  <!-- Arrow to LLM -->
  <path d="M930 450 L970 450" stroke="#ff9800" stroke-width="3" fill="none" marker-end="url(#arrowOrange)"/>
  <circle cx="950" cy="450" r="14" fill="#ff9800"/>
  <text x="950" y="455" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">4</text>
  
  <!-- Raw Data Extraction -->
  <rect x="980" y="315" width="380" height="270" rx="10" fill="url(#fileGrad)" filter="url(#shadow)"/>
  <text x="1170" y="345" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸ“„ Key File Content Extraction</text>
  
  <rect x="995" y="360" width="350" height="210" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="1170" y="382" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#1565c0" text-anchor="middle">Read &amp; Parse Configuration Files:</text>
  
  <text x="1010" y="405" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#37474f" font-weight="600">ğŸ“¦ pom.xml parsing:</text>
  <text x="1020" y="420" font-family="Consolas, monospace" font-size="9" fill="#64748b">- java.version, spring-boot.version</text>
  <text x="1020" y="435" font-family="Consolas, monospace" font-size="9" fill="#64748b">- packaging (jar/war), dependencies</text>
  
  <text x="1010" y="458" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#37474f" font-weight="600">ğŸ“¦ package.json parsing:</text>
  <text x="1020" y="473" font-family="Consolas, monospace" font-size="9" fill="#64748b">- node version, scripts (build/test)</text>
  <text x="1020" y="488" font-family="Consolas, monospace" font-size="9" fill="#64748b">- dependencies, devDependencies</text>
  
  <text x="1010" y="511" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#37474f" font-weight="600">ğŸ“¦ requirements.txt / pyproject.toml:</text>
  <text x="1020" y="526" font-family="Consolas, monospace" font-size="9" fill="#64748b">- python version, framework (django/flask)</text>
  
  <text x="1010" y="549" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#37474f" font-weight="600">ğŸ” Existing configs check:</text>
  <text x="1020" y="564" font-family="Consolas, monospace" font-size="9" fill="#64748b">- Dockerfile, .gitlab-ci.yml, .dockerignore</text>

  <!-- ==================== STEP 3: LLM ANALYSIS ==================== -->
  <rect x="20" y="625" width="1360" height="320" rx="12" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" filter="url(#shadow)"/>
  <text x="40" y="655" font-family="Segoe UI, Arial, sans-serif" font-size="18" font-weight="bold" fill="#7b1fa2">STEP 3: LLM Deep Analysis &amp; Context Enrichment</text>
  
  <!-- Collected Data Package -->
  <rect x="40" y="680" width="320" height="245" rx="10" fill="white" stroke="#9c27b0" stroke-width="2" filter="url(#shadow)"/>
  <text x="200" y="705" font-family="Segoe UI, Arial, sans-serif" font-size="13" font-weight="bold" fill="#7b1fa2" text-anchor="middle">ğŸ“‹ Collected Detection Data</text>
  
  <rect x="55" y="720" width="290" height="190" rx="4" fill="#fce4ec"/>
  <text x="65" y="742" font-family="Consolas, monospace" font-size="10" fill="#4a148c">{</text>
  <text x="75" y="760" font-family="Consolas, monospace" font-size="9" fill="#37474f">"files_found": ["pom.xml", "src/"],</text>
  <text x="75" y="778" font-family="Consolas, monospace" font-size="9" fill="#37474f">"languages_api": {"Java": 85},</text>
  <text x="75" y="796" font-family="Consolas, monospace" font-size="9" fill="#37474f">"pom_parsed": {</text>
  <text x="85" y="814" font-family="Consolas, monospace" font-size="9" fill="#37474f">"java_version": "17",</text>
  <text x="85" y="832" font-family="Consolas, monospace" font-size="9" fill="#37474f">"spring_boot": "3.2.0",</text>
  <text x="85" y="850" font-family="Consolas, monospace" font-size="9" fill="#37474f">"packaging": "jar"</text>
  <text x="75" y="868" font-family="Consolas, monospace" font-size="9" fill="#37474f">},</text>
  <text x="75" y="886" font-family="Consolas, monospace" font-size="9" fill="#37474f">"existing_docker": false,</text>
  <text x="75" y="900" font-family="Consolas, monospace" font-size="9" fill="#37474f">"existing_ci": false</text>
  <text x="65" y="915" font-family="Consolas, monospace" font-size="10" fill="#4a148c">}</text>
  
  <!-- Arrow to LLM -->
  <path d="M360 800 L410 800" stroke="#9c27b0" stroke-width="3" fill="none" marker-end="url(#arrowPurple)"/>
  <circle cx="385" cy="800" r="14" fill="#9c27b0"/>
  <text x="385" y="805" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">5</text>
  
  <!-- LLM Processing -->
  <rect x="420" y="680" width="350" height="245" rx="10" fill="url(#aiGrad)" filter="url(#shadow)"/>
  <text x="595" y="708" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸ¤– Ollama LLM Analysis</text>
  
  <rect x="435" y="725" width="320" height="185" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="595" y="748" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#7b1fa2" text-anchor="middle">LLM Prompt (System + Detection Data):</text>
  
  <text x="445" y="770" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f" font-style="italic">"Analyze this repository structure and determine:</text>
  <text x="445" y="788" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">1. Primary language &amp; version</text>
  <text x="445" y="806" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">2. Build tool &amp; package manager</text>
  <text x="445" y="824" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">3. Framework detection (Spring/Django/Express)</text>
  <text x="445" y="842" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">4. Runtime requirements (JDK/Node/Python ver)</text>
  <text x="445" y="860" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">5. Build output type (JAR/WAR/dist/wheel)</text>
  <text x="445" y="878" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">6. Special requirements (private deps, certs)"</text>
  
  <text x="595" y="900" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#7b1fa2" text-anchor="middle">Model: codellama:13b / deepseek-coder</text>
  
  <!-- Arrow to RAG -->
  <path d="M770 800 L820 800" stroke="#7b1fa2" stroke-width="3" fill="none" marker-end="url(#arrowPurple)"/>
  <circle cx="795" cy="800" r="14" fill="#7b1fa2"/>
  <text x="795" y="805" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">6</text>
  
  <!-- RAG Enhancement -->
  <rect x="830" y="680" width="280" height="245" rx="10" fill="url(#ragGrad)" filter="url(#shadow)"/>
  <text x="970" y="708" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸ“š ChromaDB RAG Query</text>
  
  <rect x="845" y="725" width="250" height="185" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="970" y="748" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#311b92" text-anchor="middle">Retrieve Similar Patterns:</text>
  
  <text x="855" y="770" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">ğŸ” Query: "Java 17 Spring Boot 3.x"</text>
  <text x="855" y="792" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f" font-weight="600">Returns:</text>
  <text x="865" y="810" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">â€¢ Approved base images for Java 17</text>
  <text x="865" y="828" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">â€¢ Standard multi-stage Dockerfile</text>
  <text x="865" y="846" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">â€¢ Known issues &amp; fixes for Spring Boot</text>
  <text x="865" y="864" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">â€¢ Maven build commands</text>
  <text x="865" y="882" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#37474f">â€¢ Security scan configurations</text>
  <text x="865" y="900" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">â€¢ Past success patterns (auto-learned)</text>
  
  <!-- Arrow to Output -->
  <path d="M1110 800 L1150 800" stroke="#311b92" stroke-width="3" fill="none" marker-end="url(#arrowPurple)"/>
  <circle cx="1130" cy="800" r="14" fill="#311b92"/>
  <text x="1130" y="805" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">7</text>
  
  <!-- Detection Result -->
  <rect x="1160" y="680" width="200" height="245" rx="10" fill="url(#outputGrad)" filter="url(#shadow)"/>
  <text x="1260" y="708" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">âœ… LLM Output</text>
  
  <rect x="1175" y="725" width="170" height="185" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="1260" y="745" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#2e7d32" text-anchor="middle">Structured JSON</text>
  <text x="1185" y="765" font-family="Consolas, monospace" font-size="8" fill="#37474f">{</text>
  <text x="1190" y="780" font-family="Consolas, monospace" font-size="8" fill="#37474f">"language": "java",</text>
  <text x="1190" y="795" font-family="Consolas, monospace" font-size="8" fill="#37474f">"version": "17",</text>
  <text x="1190" y="810" font-family="Consolas, monospace" font-size="8" fill="#37474f">"build_tool": "maven",</text>
  <text x="1190" y="825" font-family="Consolas, monospace" font-size="8" fill="#37474f">"framework": "spring-boot",</text>
  <text x="1190" y="840" font-family="Consolas, monospace" font-size="8" fill="#37474f">"fw_version": "3.2.0",</text>
  <text x="1190" y="855" font-family="Consolas, monospace" font-size="8" fill="#37474f">"output_type": "jar",</text>
  <text x="1190" y="870" font-family="Consolas, monospace" font-size="8" fill="#37474f">"base_image":</text>
  <text x="1195" y="885" font-family="Consolas, monospace" font-size="7" fill="#37474f">"eclipse-temurin:17-jre",</text>
  <text x="1190" y="900" font-family="Consolas, monospace" font-size="8" fill="#37474f">"confidence": 0.95</text>
  <text x="1185" y="915" font-family="Consolas, monospace" font-size="8" fill="#37474f">}</text>

  <!-- ==================== STEP 4: FINAL OUTPUT ==================== -->
  <rect x="20" y="965" width="1360" height="290" rx="12" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" filter="url(#shadow)"/>
  <text x="40" y="995" font-family="Segoe UI, Arial, sans-serif" font-size="18" font-weight="bold" fill="#2e7d32">STEP 4: Complete Detection Context â†’ Ready for Generation</text>
  
  <!-- Final Detection Context -->
  <rect x="40" y="1020" width="650" height="215" rx="10" fill="white" stroke="#4caf50" stroke-width="2" filter="url(#shadow)"/>
  <text x="365" y="1048" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="#2e7d32" text-anchor="middle">ğŸ“Š Complete Auto-Detected Context (Sent to Generation Phase)</text>
  
  <rect x="55" y="1065" width="620" height="155" rx="6" fill="#e8f5e9"/>
  <text x="65" y="1088" font-family="Consolas, monospace" font-size="10" fill="#1b5e20">{</text>
  <text x="80" y="1106" font-family="Consolas, monospace" font-size="9" fill="#37474f">"detected_stack": {</text>
  <text x="95" y="1124" font-family="Consolas, monospace" font-size="9" fill="#37474f">"language": "java", "version": "17", "build_tool": "maven",</text>
  <text x="95" y="1142" font-family="Consolas, monospace" font-size="9" fill="#37474f">"framework": "spring-boot", "framework_version": "3.2.0",</text>
  <text x="95" y="1160" font-family="Consolas, monospace" font-size="9" fill="#37474f">"output_artifact": "target/*.jar", "artifact_type": "fat-jar"</text>
  <text x="80" y="1178" font-family="Consolas, monospace" font-size="9" fill="#37474f">},</text>
  <text x="80" y="1196" font-family="Consolas, monospace" font-size="9" fill="#2e7d32">"user_inputs": { "target_registry": "nexus-prod:5001", "environment": "dev" },</text>
  <text x="80" y="1214" font-family="Consolas, monospace" font-size="9" fill="#7b1fa2">"rag_context": { "base_image": "eclipse-temurin:17-jre", "patterns": [...] }</text>
  <text x="65" y="1230" font-family="Consolas, monospace" font-size="10" fill="#1b5e20">}</text>
  
  <!-- Arrow to Generation -->
  <path d="M690 1130 L750 1130" stroke="#2e7d32" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
  <circle cx="720" cy="1130" r="14" fill="#2e7d32"/>
  <text x="720" y="1135" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">8</text>
  
  <!-- Generation Preview -->
  <rect x="760" y="1020" width="600" height="215" rx="10" fill="url(#aiGrad)" filter="url(#shadow)"/>
  <text x="1060" y="1048" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ğŸš€ Ready for Dockerfile &amp; CI Generation</text>
  
  <rect x="775" y="1065" width="280" height="155" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="915" y="1088" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#7b1fa2" text-anchor="middle">ğŸ“¦ Dockerfile Generation</text>
  <text x="785" y="1108" font-family="Consolas, monospace" font-size="9" fill="#37474f">FROM maven:3.9-eclipse-temurin-17</text>
  <text x="785" y="1123" font-family="Consolas, monospace" font-size="9" fill="#37474f">  AS builder</text>
  <text x="785" y="1138" font-family="Consolas, monospace" font-size="9" fill="#37474f">WORKDIR /app</text>
  <text x="785" y="1153" font-family="Consolas, monospace" font-size="9" fill="#37474f">COPY pom.xml .</text>
  <text x="785" y="1168" font-family="Consolas, monospace" font-size="9" fill="#37474f">RUN mvn dependency:go-offline</text>
  <text x="785" y="1183" font-family="Consolas, monospace" font-size="9" fill="#37474f">COPY src ./src</text>
  <text x="785" y="1198" font-family="Consolas, monospace" font-size="9" fill="#37474f">RUN mvn package -DskipTests</text>
  <text x="785" y="1213" font-family="Consolas, monospace" font-size="9" fill="#64748b">... (multi-stage continues)</text>
  
  <rect x="1065" y="1065" width="280" height="155" rx="6" fill="rgba(255,255,255,0.97)"/>
  <text x="1205" y="1088" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#7b1fa2" text-anchor="middle">ğŸ“‹ .gitlab-ci.yml Generation</text>
  <text x="1075" y="1108" font-family="Consolas, monospace" font-size="9" fill="#37474f">stages: [build, test, scan,</text>
  <text x="1085" y="1123" font-family="Consolas, monospace" font-size="9" fill="#37474f">docker, push, deploy]</text>
  <text x="1075" y="1143" font-family="Consolas, monospace" font-size="9" fill="#37474f">variables:</text>
  <text x="1085" y="1158" font-family="Consolas, monospace" font-size="9" fill="#37474f">JAVA_VERSION: "17"</text>
  <text x="1085" y="1173" font-family="Consolas, monospace" font-size="9" fill="#2e7d32">REGISTRY: nexus-prod:5001</text>
  <text x="1075" y="1193" font-family="Consolas, monospace" font-size="9" fill="#37474f">build:</text>
  <text x="1085" y="1208" font-family="Consolas, monospace" font-size="9" fill="#37474f">image: maven:3.9-eclipse...</text>

  <!-- ==================== LEGEND ==================== -->
  <rect x="20" y="1275" width="1360" height="310" rx="12" fill="white" stroke="#e0e0e0" stroke-width="1"/>
  <text x="40" y="1305" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="bold" fill="#424242">Detection Flow Summary &amp; Technical Details</text>
  
  <!-- Flow Steps -->
  <g transform="translate(40, 1320)">
    <circle cx="15" cy="12" r="12" fill="#1976d2"/>
    <text x="15" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">1</text>
    <text x="35" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">User provides repo URL only</text>
    
    <circle cx="235" cy="12" r="12" fill="#f57c00"/>
    <text x="235" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">2</text>
    <text x="255" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">Backend triggers GitLab API</text>
    
    <circle cx="455" cy="12" r="12" fill="#e24329"/>
    <text x="455" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">3</text>
    <text x="475" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">Scan file tree patterns</text>
    
    <circle cx="645" cy="12" r="12" fill="#ff9800"/>
    <text x="645" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">4</text>
    <text x="665" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">Extract &amp; parse config files</text>
    
    <circle cx="875" cy="12" r="12" fill="#9c27b0"/>
    <text x="875" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">5</text>
    <text x="895" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">LLM analyzes context</text>
    
    <circle cx="1065" cy="12" r="12" fill="#311b92"/>
    <text x="1065" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">6</text>
    <text x="1085" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">RAG enriches with patterns</text>
    
    <circle cx="1265" cy="12" r="12" fill="#2e7d32"/>
    <text x="1265" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">7</text>
    <text x="1285" y="17" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#37474f">Output context</text>
  </g>
  
  <!-- Detection Rules Table -->
  <rect x="40" y="1355" width="640" height="210" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="1"/>
  <text x="360" y="1378" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100" text-anchor="middle">ğŸ“‹ File Pattern Detection Rules</text>
  
  <text x="60" y="1400" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#37474f">Language</text>
  <text x="180" y="1400" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#37474f">Primary Files</text>
  <text x="380" y="1400" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#37474f">Build Tool Detection</text>
  <text x="560" y="1400" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#37474f">Confidence</text>
  
  <line x1="50" y1="1408" x2="670" y2="1408" stroke="#ffcc80" stroke-width="1"/>
  
  <text x="60" y="1425" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#b71c1c">â˜• Java</text>
  <text x="180" y="1425" font-family="Consolas, monospace" font-size="9" fill="#37474f">pom.xml, build.gradle, *.java</text>
  <text x="380" y="1425" font-family="Consolas, monospace" font-size="9" fill="#37474f">Maven/Gradle (from file)</text>
  <text x="560" y="1425" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (95%)</text>
  
  <text x="60" y="1445" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#1b5e20">ğŸ Python</text>
  <text x="180" y="1445" font-family="Consolas, monospace" font-size="9" fill="#37474f">requirements.txt, setup.py, *.py</text>
  <text x="380" y="1445" font-family="Consolas, monospace" font-size="9" fill="#37474f">pip/poetry/pipenv</text>
  <text x="560" y="1445" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (95%)</text>
  
  <text x="60" y="1465" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#33691e">ğŸ“¦ Node.js</text>
  <text x="180" y="1465" font-family="Consolas, monospace" font-size="9" fill="#37474f">package.json, *.js, *.ts</text>
  <text x="380" y="1465" font-family="Consolas, monospace" font-size="9" fill="#37474f">npm/yarn/pnpm (lockfile)</text>
  <text x="560" y="1465" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (95%)</text>
  
  <text x="60" y="1485" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#006064">ğŸ¹ Go</text>
  <text x="180" y="1485" font-family="Consolas, monospace" font-size="9" fill="#37474f">go.mod, go.sum, *.go</text>
  <text x="380" y="1485" font-family="Consolas, monospace" font-size="9" fill="#37474f">go modules</text>
  <text x="560" y="1485" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (98%)</text>
  
  <text x="60" y="1505" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#4a148c">ğŸ”· .NET</text>
  <text x="180" y="1505" font-family="Consolas, monospace" font-size="9" fill="#37474f">*.csproj, *.sln, *.cs</text>
  <text x="380" y="1505" font-family="Consolas, monospace" font-size="9" fill="#37474f">dotnet CLI / MSBuild</text>
  <text x="560" y="1505" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (95%)</text>
  
  <text x="60" y="1525" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#bf360c">ğŸ¦€ Rust</text>
  <text x="180" y="1525" font-family="Consolas, monospace" font-size="9" fill="#37474f">Cargo.toml, *.rs</text>
  <text x="380" y="1525" font-family="Consolas, monospace" font-size="9" fill="#37474f">cargo</text>
  <text x="560" y="1525" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#2e7d32">High (98%)</text>
  
  <text x="60" y="1545" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#607d8b">ğŸ”€ Multi</text>
  <text x="180" y="1545" font-family="Consolas, monospace" font-size="9" fill="#37474f">Multiple patterns found</text>
  <text x="380" y="1545" font-family="Consolas, monospace" font-size="9" fill="#37474f">LLM decides primary</text>
  <text x="560" y="1545" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#ff9800">Medium (80%)</text>
  
  <!-- API Endpoints -->
  <rect x="700" y="1355" width="660" height="210" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="1"/>
  <text x="1030" y="1378" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565c0" text-anchor="middle">ğŸ”Œ GitLab API Endpoints Used</text>
  
  <text x="720" y="1405" font-family="Consolas, monospace" font-size="10" fill="#1565c0" font-weight="600">GET /api/v4/projects/:id/repository/tree</text>
  <text x="730" y="1422" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748b">â†’ List all files/directories (recursive)</text>
  
  <text x="720" y="1445" font-family="Consolas, monospace" font-size="10" fill="#1565c0" font-weight="600">GET /api/v4/projects/:id/repository/files/:path/raw</text>
  <text x="730" y="1462" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748b">â†’ Read content of pom.xml, package.json, etc.</text>
  
  <text x="720" y="1485" font-family="Consolas, monospace" font-size="10" fill="#1565c0" font-weight="600">GET /api/v4/projects/:id/languages</text>
  <text x="730" y="1502" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748b">â†’ Get language breakdown by percentage</text>
  
  <text x="720" y="1525" font-family="Consolas, monospace" font-size="10" fill="#1565c0" font-weight="600">GET /api/v4/projects/:id</text>
  <text x="730" y="1542" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748b">â†’ Project metadata (default branch, visibility)</text>
  
  <text x="720" y="1565" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#7b1fa2" font-weight="600">MCP Tool: gitlab_inspect_repo(repo_url) â†’ Returns structured detection data</text>

</svg>