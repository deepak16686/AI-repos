<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <linearGradient id="runnerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fc6d26"/>
      <stop offset="100%" style="stop-color:#e24329"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ffd93d"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="900" fill="#0a0a0f"/>

  <!-- Header -->
  <rect x="0" y="0" width="1400" height="60" fill="url(#headerGrad)"/>
  <text x="700" y="38" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="24" font-weight="bold">GitLab Runner Execution Architecture</text>
  <text x="1380" y="38" text-anchor="end" fill="#888" font-family="Arial, sans-serif" font-size="12">Docker-in-Docker Pipeline Execution</text>

  <!-- GitLab Server and Runner -->
  <g transform="translate(50, 80)">
    <text x="0" y="0" fill="#fc6d26" font-family="Arial, sans-serif" font-size="16" font-weight="bold">GitLab CE &amp; Runner Configuration</text>

    <g filter="url(#shadow)" transform="translate(0, 30)">
      <rect x="0" y="0" width="500" height="200" rx="15" fill="url(#runnerGrad)"/>
      <text x="250" y="30" text-anchor="middle" fill="#fff" font-family="Arial, sans-serif" font-size="16" font-weight="bold">GitLab CE Server</text>
      <text x="250" y="50" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="10">gitlab-server:80 | localhost:8929</text>

      <rect x="15" y="65" width="470" height="120" rx="10" fill="rgba(0,0,0,0.3)"/>
      <text x="30" y="90" fill="#ffd93d" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Components:</text>
      <text x="40" y="110" fill="#e0e0e0" font-family="monospace" font-size="9">API v4 | Web UI | Git Repository</text>
      <text x="40" y="128" fill="#e0e0e0" font-family="monospace" font-size="9">CI/CD Coordinator | Pipeline Engine</text>
      <text x="30" y="155" fill="#81ecec" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Volume:</text>
      <text x="85" y="155" fill="#e0e0e0" font-family="monospace" font-size="9">gitlab-config, gitlab-logs, gitlab-data</text>
      <text x="30" y="175" fill="#888" font-family="monospace" font-size="9">Hostname: gitlab-server (Docker internal)</text>
    </g>

    <!-- GitLab Runner -->
    <g filter="url(#shadow)" transform="translate(550, 30)">
      <rect x="0" y="0" width="500" height="200" rx="15" fill="#2d3436" stroke="#fc6d26" stroke-width="2"/>
      <text x="250" y="30" text-anchor="middle" fill="#fc6d26" font-family="Arial, sans-serif" font-size="16" font-weight="bold">GitLab Runner</text>
      <text x="250" y="50" text-anchor="middle" fill="#888" font-family="monospace" font-size="10">Executor: Docker | privileged: true</text>

      <rect x="15" y="65" width="470" height="120" rx="10" fill="rgba(0,0,0,0.3)"/>
      <text x="30" y="90" fill="#ffd93d" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Configuration:</text>
      <text x="40" y="110" fill="#e0e0e0" font-family="monospace" font-size="9">REGISTRATION_TOKEN: ${RUNNER_TOKEN}</text>
      <text x="40" y="128" fill="#e0e0e0" font-family="monospace" font-size="9">CI_SERVER_URL: http://gitlab-server</text>
      <text x="40" y="146" fill="#e0e0e0" font-family="monospace" font-size="9">DOCKER_NETWORK_MODE: platform-net</text>
      <text x="30" y="170" fill="#81ecec" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Mount:</text>
      <text x="85" y="170" fill="#e0e0e0" font-family="monospace" font-size="9">/var/run/docker.sock (for DinD)</text>
    </g>

    <!-- Connection -->
    <g stroke="#ffd93d" stroke-width="2">
      <line x1="500" y1="130" x2="550" y2="130" marker-end="url(#arrowhead)"/>
    </g>
    <text x="525" y="125" text-anchor="middle" fill="#ffd93d" font-family="monospace" font-size="8">register</text>
  </g>

  <!-- Job Execution Flow -->
  <g transform="translate(50, 330)">
    <text x="0" y="0" fill="#00b894" font-family="Arial, sans-serif" font-size="16" font-weight="bold">Pipeline Job Execution Flow</text>

    <g filter="url(#shadow)" transform="translate(0, 30)">
      <rect x="0" y="0" width="1300" height="180" rx="15" fill="#1a1a2e"/>

      <!-- Step 1: Trigger -->
      <g transform="translate(20, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(252,109,38,0.3)"/>
        <text x="90" y="20" text-anchor="middle" fill="#fc6d26" font-family="Arial, sans-serif" font-size="10" font-weight="bold">1. Pipeline Triggered</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">git push / API call</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">.gitlab-ci.yml parsed</text>
      </g>
      <text x="215" y="55" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14">→</text>

      <!-- Step 2: Job Queue -->
      <g transform="translate(235, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(108,92,231,0.3)"/>
        <text x="90" y="20" text-anchor="middle" fill="#a29bfe" font-family="Arial, sans-serif" font-size="10" font-weight="bold">2. Job Queued</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">GitLab coordinator</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">Waiting for runner</text>
      </g>
      <text x="430" y="55" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14">→</text>

      <!-- Step 3: Runner Picks -->
      <g transform="translate(450, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(0,184,148,0.3)"/>
        <text x="90" y="20" text-anchor="middle" fill="#00b894" font-family="Arial, sans-serif" font-size="10" font-weight="bold">3. Runner Picks Job</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">Tags: docker</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">Pull job config</text>
      </g>
      <text x="645" y="55" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14">→</text>

      <!-- Step 4: Docker Pull -->
      <g transform="translate(665, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(27,165,173,0.3)"/>
        <text x="90" y="20" text-anchor="middle" fill="#1ba5ad" font-family="Arial, sans-serif" font-size="10" font-weight="bold">4. Pull Image</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">From localhost:5001</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">Nexus private registry</text>
      </g>
      <text x="860" y="55" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14">→</text>

      <!-- Step 5: Execute -->
      <g transform="translate(880, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(253,203,110,0.3)"/>
        <text x="90" y="20" text-anchor="middle" fill="#fdcb6e" font-family="Arial, sans-serif" font-size="10" font-weight="bold">5. Execute Scripts</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">In container</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">before/script/after</text>
      </g>
      <text x="1075" y="55" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14">→</text>

      <!-- Step 6: Report -->
      <g transform="translate(1095, 20)">
        <rect x="0" y="0" width="180" height="70" rx="8" fill="rgba(0,184,148,0.5)"/>
        <text x="90" y="20" text-anchor="middle" fill="#00b894" font-family="Arial, sans-serif" font-size="10" font-weight="bold">6. Report Status</text>
        <text x="90" y="40" text-anchor="middle" fill="#e0e0e0" font-family="monospace" font-size="8">Upload artifacts</text>
        <text x="90" y="55" text-anchor="middle" fill="#888" font-family="monospace" font-size="7">Job success/failure</text>
      </g>

      <!-- Docker-in-Docker detail -->
      <rect x="20" y="100" width="1260" height="65" rx="8" fill="rgba(0,0,0,0.3)"/>
      <text x="40" y="120" fill="#ffd93d" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Docker-in-Docker (DinD) Setup:</text>
      <text x="40" y="140" fill="#e0e0e0" font-family="monospace" font-size="9">Runner mounts /var/run/docker.sock → Allows container to create other containers (Kaniko, services)</text>
      <text x="40" y="158" fill="#888" font-family="monospace" font-size="9">Network: FF_NETWORK_PER_BUILD=true → Each build gets isolated network within platform-net</text>
    </g>
  </g>

  <!-- Runner Configuration -->
  <g transform="translate(50, 560)">
    <text x="0" y="0" fill="#6c5ce7" font-family="Arial, sans-serif" font-size="16" font-weight="bold">Runner Configuration (config.toml equivalent)</text>

    <g filter="url(#shadow)" transform="translate(0, 25)">
      <rect x="0" y="0" width="640" height="270" rx="15" fill="#2d3436"/>

      <rect x="15" y="15" width="610" height="240" rx="10" fill="rgba(0,0,0,0.3)"/>
      <text x="30" y="40" fill="#ffd93d" font-family="monospace" font-size="10">docker-compose.yml - gitlab-runner service:</text>
      <text x="30" y="65" fill="#e0e0e0" font-family="monospace" font-size="9">image: gitlab/gitlab-runner:latest</text>
      <text x="30" y="85" fill="#e0e0e0" font-family="monospace" font-size="9">environment:</text>
      <text x="40" y="103" fill="#81ecec" font-family="monospace" font-size="9">REGISTRATION_TOKEN: ${GITLAB_RUNNER_TOKEN}</text>
      <text x="40" y="121" fill="#81ecec" font-family="monospace" font-size="9">CI_SERVER_URL: http://gitlab-server</text>
      <text x="40" y="139" fill="#81ecec" font-family="monospace" font-size="9">RUNNER_EXECUTOR: docker</text>
      <text x="40" y="157" fill="#81ecec" font-family="monospace" font-size="9">DOCKER_IMAGE: alpine:latest</text>
      <text x="40" y="175" fill="#81ecec" font-family="monospace" font-size="9">DOCKER_PRIVILEGED: "true"</text>
      <text x="40" y="193" fill="#81ecec" font-family="monospace" font-size="9">DOCKER_NETWORK_MODE: platform-net</text>
      <text x="30" y="215" fill="#e0e0e0" font-family="monospace" font-size="9">volumes:</text>
      <text x="40" y="233" fill="#888" font-family="monospace" font-size="9">- /var/run/docker.sock:/var/run/docker.sock</text>
    </g>

    <!-- Job Tags -->
    <g filter="url(#shadow)" transform="translate(670, 25)">
      <rect x="0" y="0" width="580" height="270" rx="15" fill="#1a1a2e"/>
      <text x="290" y="30" text-anchor="middle" fill="#fc6d26" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Pipeline Job Configuration</text>

      <rect x="15" y="45" width="550" height="210" rx="10" fill="rgba(0,0,0,0.3)"/>
      <text x="30" y="70" fill="#ffd93d" font-family="monospace" font-size="10">.gitlab-ci.yml job template:</text>
      <text x="30" y="95" fill="#e0e0e0" font-family="monospace" font-size="9">compile:</text>
      <text x="40" y="113" fill="#e0e0e0" font-family="monospace" font-size="9">stage: compile</text>
      <text x="40" y="131" fill="#81ecec" font-family="monospace" font-size="9">image: ${NEXUS_PULL_REGISTRY}/maven:3.9</text>
      <text x="40" y="149" fill="#e0e0e0" font-family="monospace" font-size="9">tags:</text>
      <text x="50" y="167" fill="#00b894" font-family="monospace" font-size="9">- docker  # Matches runner tag</text>
      <text x="40" y="185" fill="#e0e0e0" font-family="monospace" font-size="9">script:</text>
      <text x="50" y="203" fill="#888" font-family="monospace" font-size="9">- mvn clean package -DskipTests</text>
      <text x="40" y="221" fill="#e0e0e0" font-family="monospace" font-size="9">artifacts:</text>
      <text x="50" y="239" fill="#888" font-family="monospace" font-size="9">paths: [target/app.jar]</text>
    </g>
  </g>

  <!-- Footer -->
  <text x="700" y="880" text-anchor="middle" fill="#555" font-family="Arial, sans-serif" font-size="11">AI-Powered DevOps Platform | GitLab Runner | Docker-in-Docker Pipeline Execution</text>
</svg>